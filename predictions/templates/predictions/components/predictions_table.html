<!-- Shared Predictions Table Component -->
<!-- Desktop Table -->
<div class="hidden md:block overflow-x-auto max-h-[70vh] overflow-y-auto no-scrollbar">
  <table class="w-full">
    <thead class="bg-secondary border-b border-border sticky top-0 z-10">
      <tr>
        <th class="text-left py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground w-8">#</th>
        <th class="text-left py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Date</th>
        <th class="text-left py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Match</th>
        <th class="text-center py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Score</th>
        <th class="text-left py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Prediction</th>
        <th class="text-center py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Confidence</th>
        <th class="text-center py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground">Status</th>
        <th class="text-center py-3 px-4 text-xs font-semibold uppercase tracking-wide text-muted-foreground w-16">Details</th>
      </tr>
    </thead>
    {% for match in matches %}
    <tbody x-data="{ expanded: false }" class="border-b border-border">
      <tr class="hover:bg-secondary/30 transition-colors">
        <td class="py-3 px-4 text-sm font-medium text-muted-foreground">{{ forloop.counter }}</td>
        <td class="py-3 px-4 text-sm text-muted-foreground">{{ match.match_date|date:"M d, H:i" }}</td>
        <td class="py-3 px-4">
          <div class="flex items-center gap-2">
            <div>
              <div class="font-semibold text-foreground">{{ match.home_team }} vs {{ match.away_team }}</div>
              <div class="text-xs text-muted-foreground">{{ match.league_name }}</div>
            </div>
            {% if match.is_in_daily_acca %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-600 rounded-md text-xs font-semibold flex-shrink-0">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
              </svg>
              ACCA
            </span>
            {% endif %}
          </div>
        </td>
        <td class="py-3 px-4 text-center">
          {% if match.result_fetched %}
            <div class="font-bold text-foreground">{{ match.home_score }} - {{ match.away_score }}</div>
          {% else %}
            <span class="text-xs text-muted-foreground">-</span>
          {% endif %}
        </td>
        <td class="py-3 px-4">
          <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 border border-primary/20 rounded-md">
            <svg class="w-3.5 h-3.5 text-primary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-sm font-medium text-foreground">{{ match.suggested_bet|default:"N/A" }}</span>
          </div>
        </td>
        <td class="py-3 px-4 text-center">
          {% if match.confidence_score >= 8.0 %}
          <span class="inline-flex items-center justify-center bg-primary text-primary-foreground px-3 py-1 rounded-full text-sm font-bold min-w-[60px]">{{ match.confidence_score|floatformat:1 }}</span>
          {% elif match.confidence_score >= 6.0 %}
          <span class="inline-flex items-center justify-center bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm font-bold min-w-[60px]">{{ match.confidence_score|floatformat:1 }}</span>
          {% else %}
          <span class="inline-flex items-center justify-center bg-muted text-muted-foreground px-3 py-1 rounded-full text-sm font-bold min-w-[60px]">{{ match.confidence_score|floatformat:1 }}</span>
          {% endif %}
        </td>
        <td class="py-3 px-4 text-center">
          {% if match.result_fetched and match.match_status == 'FT' %}
            {% if match.prediction_correct %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 text-primary rounded-md text-sm font-semibold">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              WIN
            </span>
            {% else %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-red-500/20 text-red-500 rounded-md text-sm font-semibold">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              LOSS
            </span>
            {% endif %}
          {% elif match.result_fetched and match.match_status == 'LIVE' %}
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-500 rounded-md text-sm font-semibold">
              <span class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></span>
              LIVE
            </span>
          {% else %}
            <span class="text-xs text-muted-foreground">Upcoming</span>
          {% endif %}
        </td>
        <td class="py-3 px-4 text-center">
          {% if match.gemini_analysis or match.post_mortem_analysis %}
          <button @click="expanded = !expanded"
                  class="inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-secondary transition-colors">
            <svg class="w-5 h-5 text-muted-foreground transition-transform duration-200"
                 :class="{ 'rotate-180': expanded }"
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          {% else %}
          <span class="text-xs text-muted-foreground">-</span>
          {% endif %}
        </td>
      </tr>

      <!-- Expandable Analysis Row -->
      {% if match.gemini_analysis or match.post_mortem_analysis %}
      <tr x-show="expanded" x-collapse x-cloak class="bg-secondary/50">
        <td colspan="8" class="px-4 py-0">
          <div class="py-5 px-4">
            <div class="flex items-start gap-3">
              <svg class="w-5 h-5 text-accent mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              <div class="flex-1">
                <h4 class="text-sm font-semibold uppercase tracking-wide text-accent mb-2">
                  {% if match.post_mortem_analysis %}AI Post-Mortem Analysis{% else %}AI Pre-Match Analysis{% endif %}
                </h4>
                <p class="text-sm text-foreground leading-relaxed whitespace-pre-wrap">
                  {{ match.post_mortem_analysis|default:match.gemini_analysis }}
                </p>
              </div>
            </div>
          </div>
        </td>
      </tr>
      {% endif %}
    </tbody>
    {% endfor %}
  </table>
</div>

<!-- Mobile Cards -->
<div class="md:hidden divide-y divide-border">
  {% for match in matches %}
  <div x-data="{ expanded: false }" class="p-4">
    <div class="flex items-start justify-between gap-3 mb-3">
      <div class="flex-1">
        <div class="flex items-center gap-2 mb-1">
          <span class="text-xs font-bold text-muted-foreground">#{{ forloop.counter }}</span>
          {% if match.result_fetched and match.match_status == 'FT' %}
            {% if match.prediction_correct %}
            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-primary/20 text-primary rounded text-xs font-bold">✓ WIN</span>
            {% else %}
            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-red-500/20 text-red-500 rounded text-xs font-bold">✗ LOSS</span>
            {% endif %}
          {% endif %}
          <span class="inline-block px-2 py-0.5 bg-muted text-muted-foreground rounded text-xs font-medium">{{ match.confidence_score|floatformat:1 }}</span>
        </div>
        <div class="flex items-center gap-2 mb-1">
          <h3 class="font-semibold text-foreground">
            {{ match.home_team }}
            {% if match.result_fetched %}{{ match.home_score }}-{{ match.away_score }}{% else %}vs{% endif %}
            {{ match.away_team }}
          </h3>
          {% if match.is_in_daily_acca %}
          <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-500/20 text-yellow-600 rounded text-xs font-bold flex-shrink-0">
            ⭐ ACCA
          </span>
          {% endif %}
        </div>
        <p class="text-xs text-muted-foreground mb-2">{{ match.league_name }} · {{ match.match_date|date:"M d, H:i" }}</p>
        <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 border border-primary/20 rounded-md text-sm">
          <span class="font-medium text-foreground">{{ match.suggested_bet }}</span>
        </div>
      </div>
      {% if match.gemini_analysis or match.post_mortem_analysis %}
      <button @click="expanded = !expanded" class="flex-shrink-0 w-9 h-9 rounded-md hover:bg-secondary transition-colors">
        <svg class="w-5 h-5 text-muted-foreground transition-transform duration-200 mx-auto"
             :class="{ 'rotate-180': expanded }"
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      {% endif %}
    </div>

    {% if match.gemini_analysis or match.post_mortem_analysis %}
    <div x-show="expanded" x-collapse x-cloak class="mt-3 pt-3 border-t border-border">
      <div class="flex items-start gap-2 mb-2">
        <svg class="w-4 h-4 text-accent mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
        <h4 class="text-xs font-semibold uppercase tracking-wide text-accent">AI Analysis</h4>
      </div>
      <p class="text-sm text-foreground leading-relaxed whitespace-pre-wrap">
        {{ match.post_mortem_analysis|default:match.gemini_analysis }}
      </p>
    </div>
    {% endif %}
  </div>
  {% endfor %}
</div>
